---

# Example analysis file to run a demo OpenCOVID analysis
  
# ---- Baseline settings ----

population_size: 100000
        
# Number of days to simulate
n_days: 200
n_days_init: -50

# Initial conditions (sample from normal distribution)
previously_infected:
  uncertainty:
    fn: "norm"  # Options: unif (min, max), norm (mean, sd), pois (lambda)
    mean: 0.1
    sd: 0.04



# Number of days to shift seasonality start
seasonality_shift: 150  # 0 represents mid-winter

# Seasonality conditions (sample from normal distribution)
#seasonality_scaler:
#  uncertainty:
#    fn: "norm"  # Options: unif (min, max), norm (mean, sd), pois (lambda)
#    mean: 0.0
#    sd: 0.04

# ---- Effective reproduction number ----

# Effective reproduction number at analysis start
Re: 2.0  # Can be calibrated in step 1 (set calibration_type: "Re_user" to use)


# ---- Network structure ----

# Network structure
#
# OPTIONS: "random", "age", or "layers"
network_structure: "age"

# Network layers - only relevant if network structure is set to "layers"
#
# OPTIONS: "household", "school", "workplace"
network_layers: household, school, workplace

# Countries to pull network matrix data from
contact_matrix_countries: BE  # ISO Alpha-2 country codes (en.wikipedia.org/wiki/ISO_3166-1_alpha-2)

# ---- Viral variants ----

# Primary variant (properties relative to prognosis probabilities)
variant_primary:
  id: omicron
  name: "Omicron"
  infectivity: 14.4
  severity: 1.54
  immuno_escape: 0.0
  
  # Viral load profile
viral_load_infectivity: yes
viral_load_shape_fn: 
  fn: "dgamma"
  shape: 3.0
  rate: 0.5
  
# Immunity through natural infection
acquired_immunity:
  fn: "logistic_inv"
  slope: 1.8
  mid: 105
  lb: 0.15
  ub: 0.95


# ---- Priority and risk groups ----

# Priority group definitions
priority_groups: 
- id: high_risk
  name: "65+ or comorbidities"
  priority: 1
  condition: "age >= 65 | comorbidities == TRUE"
- id: low_risk
  name: "18-65 year olds"
  priority: 2
  condition: "age >= 18 & age < 65"
  

# ---- Biological and epidemiological parameters ----

# Probability of asymptomatic infection (assumed not be age-specific)
proportion_asymptomatic: 0.33
  
# Age-related probabiliy of severe disease given person is symptomatic
severe_symptom_age:
  fn: "logistic"
  slope: 6
  mid: 65
  lower: 0
  upper: 0.3
  
# Age-related probabiliy of critical disease given person is severe
critical_severe_age:
  fn: "logistic"
  slope: 6
  mid: 100
  lower: 0.05
  upper: 1.9
  
# Age-related probabiliy of death given person is critical
death_critical_age:
  fn: "logistic"
  slope: 14
  mid: 90
  lower: 0
  upper: 2
  
# Scale factors for death when critical in/out of ICU
death_critical_icu: 1.0
death_critical_non_icu: 3.0

# Probability of seeking care if severe
seek_hospital: 0.75

# Per exposure risk scaler for ICU and death (assumed to not wane over time)
#
# See: 
#  1) www.sciencedirect.com/science/article/pii/S016344532200010X
#  2) www.thelancet.com/journals/lancet/article/PIIS0140-6736(22)00089-7/fulltext
# Also see dose_response relationship parameters
exposure_response:
  icu_risk_factor: 0.4  # Calculated from (1)
  death_risk_factor: 0.65  # Calculated from (1)
  
# Maximum number of infections to count per person
max_infection_count: 10

# Disease state durations
durations:
  latency:
    fn: "rnorm"
    mean: 4.6
    sd: 1.0
  presymptomatic:
    fn: "rnorm"
    mean: 3.0
    sd: 1.0
  infectious_mild:
    fn: "rnorm"
    mean: 6.0
    sd: 1.0
  infectious_severe: 
    fn: "rnorm"
    mean: 28.0
    sd: 1.0
  onset_to_hospital: 
    fn: "rnorm"
    mean: 13.0
    sd: 1.0
  hospital_stay: 
    fn: "rnorm"
    mean: 9.0
    sd: 1.0
  hospital_to_icu: 
    fn: "rnorm"
    mean: 2.0
    sd: 1
  icu_stay: 
    fn: "rnorm"
    mean: 7.0
    sd: 1.0
  icu_stay_death: 
    fn: "rnorm"
    mean: 6.0
    sd: 1.0
  hospital_transfer:
    fn: "rnorm"
    mean: 2.0
    sd: 1.0
  home_death: 
    fn: "rnorm"
    mean: 10.0
    sd: 1.0

# Flag for modelling non-COVID 'natural' deaths
natural_deaths: yes

# Flag for replacing COVID-related deceased with newborns
#
# NOTE: natural deaths are replaced with newborns regardless
replace_deceased: yes

# Flag for ageing people each year
annual_ageing: yes

# 101 yearly bins for ages [0-1], (1-2], ..., (100-101+] required
demography:
  1: 0.010576408
  2: 0.010811583
  3: 0.010896688
  4: 0.010928522
  5: 0.010773903
  6: 0.010815481
  7: 0.010274967
  8: 0.010219097
  9: 0.010108005
  10: 0.010069676
  11: 0.009903364
  12: 0.009705868
  13: 0.009469393
  14: 0.009229020
  15: 0.009076351
  16: 0.009010736
  17: 0.008773611
  18: 0.008846372
  19: 0.008671615
  20: 0.009396632
  21: 0.009362849
  22: 0.009643501
  23: 0.010252229
  24: 0.010779750
  25: 0.011226064
  26: 0.012029040
  27: 0.013095126
  28: 0.014302188
  29: 0.015094119
  30: 0.015867860
  31: 0.016164753
  32: 0.016590278
  33: 0.016572737
  34: 0.016617563
  35: 0.016702019
  36: 0.016664988
  37: 0.016307028
  38: 0.016560394
  39: 0.016357701
  40: 0.016451901
  41: 0.015739878
  42: 0.015550827
  43: 0.014973933
  44: 0.014849848
  45: 0.014560101
  46: 0.014482792
  47: 0.014238521
  48: 0.014273603
  49: 0.014756298
  50: 0.014849198
  51: 0.015016160
  52: 0.015149989
  53: 0.015090871
  54: 0.015155187
  55: 0.014944048
  56: 0.014902470
  57: 0.014335320
  58: 0.013497263
  59: 0.012972991
  60: 0.012270712
  61: 0.011689269
  62: 0.011112374
  63: 0.010712186
  64: 0.010361371
  65: 0.009848143
  66: 0.009359601
  67: 0.008911338
  68: 0.009055562
  69: 0.008541034
  70: 0.008761267
  71: 0.008426694
  72: 0.008458528
  73: 0.008419548
  74: 0.008336392
  75: 0.008068084
  76: 0.007888779
  77: 0.007581491
  78: 0.007091001
  79: 0.006626496
  80: 0.005900830
  81: 0.005523380
  82: 0.005232333
  83: 0.004715207
  84: 0.004624255
  85: 0.004337107
  86: 0.003957058
  87: 0.003471764
  88: 0.003121599
  89: 0.002766237
  90: 0.011291680
  91: 0
  92: 0
  93: 0
  94: 0
  95: 0
  96: 0
  97: 0
  98: 0
  99: 0
  100: 0



# Primary vaccination rollout (use -ve for past dates, +ve for future dates)
vaccine_rollout: 
- id: high_risk
  coverage: 0.0
  start: 1800   # Date index for primary vaccination to begin
  end: 1800     # Date index for primary vaccination to reach 'coverage'
- id: low_risk
  coverage: 0.0
  start: 1500
  end: 2000
  
# Vaccine booster rollout (only groups to recieve a booster need to be specified)
#booster_rollout:
#- id: high_risk
#  probability: 0.0  # Probability of accepting/receiving a booster dose - set to zero in the baseline
#  cycle_period: 180  # Booster dose administered every cycle_period days
#  start: 3000         # When booster started to be available (-ve for past, +ve for future, 0 for start of analysis period)
#  force_start: no    # Force a booster at this time regardless of when initial vaccination was (set to 'no' to turn off)
#  force_end: no      # Force an end point to stop cyclic boosters (set to 'no' to turn off)
#- id: low_risk
#  probability: 0.0  # Probability of accepting/receiving a booster dose - set to zero in the baseline
#  cycle_period: 365  # Booster dose administered every cycle_period days
#  start: 1000         # When booster started to be available (-ve for past, +ve for future, 0 for start of analysis period)
#  force_start: no    # Force a booster at this time regardless of when initial vaccination was (set to 'no' to turn off)
#  force_end: no      # Force an end point to stop cyclic boosters (set to 'no' to turn off)
  
# Vaccine updates that effectively protect from exposure to all currently circulating variants
#vaccine_update:
#- id: next_gen_vax
#  name: "2nd generation vaccine"
#  release_day: no  # Set to integer to use


# ---- Model metrics ----

# Define model metrics to report and by which grouping
model_metrics:
  all_new_infections:
    report: yes
    by: age, priority_group, vaccine_type, variant
  new_local_infections:
    report: no
    by: none
  new_importations:
    report: no
    by: none
  confirmed:
    report: yes
    by: none
  deaths:
    report: yes
    by: priority_group, vaccine_type, vaccine_doses, variant
  hospital_beds:
    report: yes
    by: priority_group, vaccine_type, vaccine_doses
  hospital_admissions:
    report: no
    by: none
  icu_beds:
    report: yes
    by: priority_group, vaccine_type, vaccine_doses
  icu_admissions:
    report: no
    by: none
  currently_infected:
    report: yes
    by: none
  currently_infectious:
    report: no
    by: none
  currently_symptomatic:
    report: no
    by: none
  currently_isolated:
    report: no
    by: none
  recovered:
    report: no
    by: none
  n_vaccinated:
    report: no
    by: priority_group
  total_vaccinated:
    report: yes
    by: priority_group
  vaccine_coverage:
    report: yes
    by: priority_group
  vaccine_coverage_pop:
    report: no
    by: none
  booster_coverage:
    report: no
    by: none
  booster_coverage_pop:
    report: no
    by: none
  booster_coverage_12m:
    report: yes
    by: priority_group
  booster_coverage_12m_pop:
    report: no
    by: none
  n_doses:
    report: yes
    by: priority_group, vaccine_type, vaccine_doses
  total_doses:
    report: yes
    by: priority_group, vaccine_type, vaccine_doses
  n_prep:
    report: no
    by: none
  total_prep:
    report: yes
    by: none
  prep_coverage:
    report: yes
    by: none
  prep_coverage_pop:
    report: no
    by: none
  n_treat:
    report: no
    by: none
  total_treat:
    report: no
    by: none
  n_treat_success:
    report: yes
    by: priority_group
  total_treat_success:
    report: yes
    by: priority_group
  treatment_coverage:
    report: no  # Available soon!
    by: none
  treatment_coverage_pop:
    report: no  # Available soon!
    by: none
  natural_deaths:
    report: no
    by: age
  births:
    report: no
  pop_age:
    report: yes
  n_infections: 
    report: yes
  variant_prevalence:
    report: yes
  Re:
    report: yes
  seroprevalence:
    report: yes
  pop_susceptibility:
    report: yes
  pop_prevalence:
    report: no
  seasonality:
    report: yes
  contact_reduction:
    report: no
  healthcare_costs:
    report: no
  intervention_costs:
    report: no
  overall_costs:
    report: yes
    
# ---- Calibration settings ----
  
# Type of calibration to perform
#
# OPTIONS:
#   Re_user: Value of 'Re' as set by the user
#   Re_data: Value of 'Re' as defined by data
#  epi_data: Fitting to temporal epidemiological data
calibration_type: "epi_data"

# Define parameters to be calibrated
calibration_parameters:
- param: "contacts"
  lower: 2
  upper: 20
  synth: 12  # Used for generating synthetic data (to test fitting algorithm)

# Additional options for Re_data and epi_data calibration
calibration_options: 
  data_synthetic: no
  data_source:
    epi: "UK"  # OPTIONS: 'ECDC' or 'UK'
    Re: "ETH"  # OPTIONS: 'ECDC' or 'ETH'
  country: UK
  country_pop: 70000000
  data_end: 2020-12-31
  data_days: 250  # For epi_data only (Re_window used for Re_data)
  data_burn_in: 30  # Number of days to simulate before data kicks in (for epi_data only)
  offset_synthetic: 0.05  # Standard deviation for offseting synthetically generated data
  
# Time period to calibrate to (epi_data only)
calibration_time_period: "week" # OPTIONS: "day", "week", "month", "quater", "year" 

# Weights for epi_data calibration only (set metrics to 0 to turn off)
calibration_weights:
  time: "none"  # OPTIONS: 'none', 'weak', 'strong', 'exponential'
  peak: "none"  # OPTIONS: 'none', 'weak', 'strong'
  metric:
    confirmed: 0.0
    deaths: 1.0
    hospital_admissions: 1.0
    icu_admissions: 1.0
    hospital_beds: 1.0
    icu_beds: 1.0

# Strength of objective function scaling
objective_scaling: "none"  # OPTIONS: 'none', 'weak', or 'strong'

# Emulator options
emulator:
  init_samples: 250       # Initial number of paramter sets
  seeds: 8                # Number of stochastic runs per sample
  test_train_split: 0.15  # Test-train split of samples (15-20% is reasonable)
  gp_kernel: "Matern5_2"  # Select GP kernel function (see ?mleHetGP)
  gp_max_iter: 1000       # Maximum number of iterations of GP algorithm

# Adaptive sampling options
#
# NOTE: Adaptive sampling is very useful for fitting to epi_data - not so much for Re
adaptive_sampling:
  rounds: 1                   # Number of rounds (set to 0 to turn adaptive sampling off)
  acquisition_points: 10000   # Number of randomly sampled points to evaluate for resampling
  min_value_accepted: 0.0001  # Lower bound for expected improvment we'll consider
  max_samples_accepted: 100   # Take at maximum n new parameter sets per round
  
# Optimisation options (for finding global minimum of emulated space)
optimisation:
  optim_runs: 20  # Number of times to perform optimisation
  optim_iters: 100  # Number of ASD iterations
  
# Time period for fitting to Re
Re_fit:
  start_day: 10  # Start fitting from day n of simulations
  n_days: 5      # Take the average over the next n days
  


# ---- Alternative scenarios ----

# Define a few single scenarios and one array scenario
scenarios:
# Single scenario assessing impact of frequent booster doses
- id: booster
  name: "Frequent low-risk booster doses"
  booster_rollout:
  - id: low_risk
    probability: 0.0
    cycle_period: 180
## Single scenario effect of an immuno-escaping variant
- id: immuno_escape
  name: "Immuno escape variant"
  variants_novel:
  - id: epsilon
    import_day: 100
    import_number: 0
## Single scenario effect of an immuno-escaping variant with next generation vaccine
#- id: vaccine_update
#  name: "Next generation vaccine"
#  variants_novel:
#  - id: epsilon
#    import_day: 100
#    import_number: 0    
#  vaccine_update:
#  - id: next_gen_vax
#    release_day: 1500
# Array scenario assessing novel variant infectivty
#- id: deltaplus_array
#  name: "Delta+ variant"
#  variants_novel:
#  - id: deltaplus
#    name: "Delta+ (AY.4.2)"
#    import_number: 0
#    infectivity:
#      array_grid:
#        id: inf
#        name: "infectivity"
#        from: 1.0
#        to: 1.5
#        by: 0.1

